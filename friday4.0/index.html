<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FRIDAY â€” AI Dashboard</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Syne:wght@400;700;800&display=swap" rel="stylesheet">
<style>
/* â”€â”€â”€ CSS VARIABLES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
:root {
  --accent:  #00e5ff;
  --accent2: #7c3aed;
  --bg:      #05080f; /* Slightly darker base for better contrast */
  --surface: rgba(17, 24, 39, 0.45); /* Semi-transparent for glass effect */
  --border:  rgba(255, 255, 255, 0.08); /* Lightened border for glass edges */
  --text:    #e2e8f0;
  --muted:   #818cf8; /* Lightened muted text for better readability on glass */
  --danger:  #ef4444;
  --success: #22c55e;
  --mono:    'Space Mono', monospace;
  --sans:    'Syne', sans-serif;
  --radius:  12px;
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

body {
  background: var(--bg);
  color: var(--text);
  font-family: var(--sans);
  min-height: 100vh;
  overflow-x: hidden;
  /* Enhanced gradients so the blur has something to distort */
  background-image:
    radial-gradient(circle at 10% 40%, rgba(0, 229, 255, 0.15) 0%, transparent 50%),
    radial-gradient(circle at 90% 60%, rgba(124, 58, 237, 0.15) 0%, transparent 50%);
  background-attachment: fixed;
}

/* â”€â”€â”€ SCANLINE OVERLAY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
body::before {
  content: '';
  position: fixed; inset: 0; pointer-events: none; z-index: 9999;
  background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,.03) 2px, rgba(0,0,0,.03) 4px);
}

/* â”€â”€â”€ TOPBAR (Glass Effect) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
header {
  display: flex; align-items: center; justify-content: space-between;
  padding: .85rem 1.5rem;
  background: rgba(10, 15, 26, 0.6);
  border-bottom: 1px solid var(--border);
  backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px);
  position: sticky; top: 0; z-index: 100;
  box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
}

.logo {
  font-family: var(--mono);
  font-size: 1.25rem;
  font-weight: 700;
  color: var(--accent);
  letter-spacing: .18em;
  display: flex; align-items: center; gap: .6rem;
}
.logo-dot { width:8px; height:8px; border-radius:50%; background:var(--accent);
  box-shadow: 0 0 8px var(--accent); animation: blink 2s infinite; }
@keyframes blink { 0%,100%{opacity:1} 50%{opacity:.3} }

.header-right { display:flex; align-items:center; gap:1rem; }

.badge {
  font-family: var(--mono); font-size:.68rem; padding:.3rem .7rem;
  border-radius:20px; border:1px solid var(--border); display:flex; align-items:center; gap:.4rem;
  background: rgba(255, 255, 255, 0.02);
}
.badge.on  { color:var(--success); border-color:rgba(34,197,94,.3); background:rgba(34,197,94,.06); }
.badge.off { color:var(--muted);   border-color:rgba(100,116,139,.2); }
.badge.warn{ color:#f59e0b;        border-color:rgba(245,158,11,.3); background:rgba(245,158,11,.06); }
.badge-dot { width:6px;height:6px;border-radius:50%; }
.badge.on  .badge-dot { background:var(--success); box-shadow:0 0 6px var(--success); }
.badge.off .badge-dot { background:var(--muted); }
.badge.warn .badge-dot { background:#f59e0b; box-shadow:0 0 6px #f59e0b; }

a.nav-link {
  font-family:var(--mono); font-size:.72rem; color:var(--muted);
  text-decoration:none; letter-spacing:.06em;
  padding:.35rem .8rem; border-radius:6px;
  border:1px solid transparent; transition:.2s;
}
a.nav-link:hover { color:var(--accent); border-color:var(--border); background: rgba(255,255,255,0.05); }

/* â”€â”€â”€ MAIN GRID â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
.grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  grid-template-rows: auto;
  gap: 1.5rem;
  padding: 1.5rem;
  max-width: 1600px; margin: 0 auto;
}

/* â”€â”€â”€ PANEL BASE (Glass Effect) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
.panel {
  background: var(--surface);
  backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  overflow: hidden;
  position: relative;
  box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.2);
}
.panel::before {
  content:''; position:absolute; top:0; left:0; right:0; height:1px;
  background: linear-gradient(90deg, transparent, rgba(0,229,255,0.5), transparent);
  opacity:.4;
}

.panel-header {
  display:flex; align-items:center; justify-content:space-between;
  padding:.85rem 1.2rem;
  border-bottom: 1px solid var(--border);
  background: rgba(0, 0, 0, 0.1);
  font-family: var(--mono); font-size:.72rem;
  letter-spacing:.1em; color:var(--muted);
}
.panel-title { display:flex; align-items:center; gap:.5rem; font-weight: bold; color: var(--text); }

.panel-body { padding:1.2rem; }

/* â”€â”€â”€ CAMERA PANEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
#camera-panel { grid-column:1; grid-row:1/3; }

#camera-feed {
  width:100%; aspect-ratio:16/9;
  background: rgba(0, 0, 0, 0.4);
  border: 1px solid var(--border);
  display:flex; align-items:center; justify-content:center;
  border-radius:var(--radius);
  overflow:hidden; position:relative;
}
#camera-img {
  width:100%; height:100%; object-fit:cover; display:none;
}
#camera-placeholder {
  display:flex; flex-direction:column; align-items:center; gap:1rem;
  color:var(--muted); font-family:var(--mono); font-size:.75rem;
}
.cam-icon { font-size:2.5rem; opacity:.5; }

#detected-label {
  position:absolute; bottom:1rem; left:1rem;
  background:rgba(0,0,0,.6);
  backdrop-filter: blur(4px);
  border:1px solid rgba(0,229,255,.3);
  font-family:var(--mono); font-size:.7rem;
  color:var(--accent); padding:.4rem .8rem; border-radius:20px;
  letter-spacing:.08em;
}

.cam-controls {
  display:flex; gap:.75rem; padding:1rem 1.2rem;
  border-top:1px solid var(--border);
  background: rgba(0, 0, 0, 0.1);
}

/* â”€â”€â”€ CHAT PANEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
#chat-panel { grid-column:2; grid-row:1; }

#chat-messages {
  height: 360px;
  overflow-y: auto;
  padding: 1rem;
  display: flex; flex-direction: column; gap: .85rem;
  scroll-behavior: smooth;
}
#chat-messages::-webkit-scrollbar { width:4px; }
#chat-messages::-webkit-scrollbar-track { background:transparent; }
#chat-messages::-webkit-scrollbar-thumb { background:rgba(255,255,255,0.1); border-radius:2px; }

.msg {
  max-width: 85%;
  padding: .75rem 1rem;
  border-radius: 12px;
  font-size: .85rem;
  line-height: 1.55;
  animation: msgIn .2s ease;
  backdrop-filter: blur(8px);
}
@keyframes msgIn { from{opacity:0;transform:translateY(6px)} to{opacity:1;transform:none} }

.msg.user {
  align-self: flex-end;
  background: rgba(124,58,237,.3);
  border: 1px solid rgba(124,58,237,.4);
  color: #fff;
}
.msg.assistant {
  align-self: flex-start;
  background: rgba(0,229,255,.1);
  border: 1px solid rgba(0,229,255,.2);
  color: var(--text);
  font-family: var(--mono);
  font-size: .8rem;
}
.msg-meta {
  font-family: var(--mono); font-size:.6rem; color:rgba(255,255,255,0.5);
  margin-top:.4rem; text-align:right;
}
.msg.assistant .msg-meta { text-align:left; }

.kb-tag {
  display:inline-block; font-size:.6rem; padding:.15rem .4rem;
  background:rgba(124,58,237,.3); border:1px solid rgba(124,58,237,.4);
  border-radius:8px; color:#d8b4fe; margin-left:.4rem; vertical-align:middle;
}

.typing-indicator {
  display: none; align-self: flex-start;
  padding: .75rem 1rem; border-radius:12px;
  background: rgba(0,229,255,.1); border:1px solid rgba(0,229,255,.2);
  backdrop-filter: blur(8px);
}
.typing-indicator span {
  display:inline-block; width:5px; height:5px; border-radius:50%;
  background:var(--accent); margin:0 2px;
  animation: typing .9s infinite;
}
.typing-indicator span:nth-child(2){ animation-delay:.15s; }
.typing-indicator span:nth-child(3){ animation-delay:.3s; }
@keyframes typing { 0%,100%{opacity:.2;transform:translateY(0)} 50%{opacity:1;transform:translateY(-4px)} }

.chat-input-row {
  display:flex; gap:.75rem;
  padding:1rem 1.2rem;
  border-top:1px solid var(--border);
  background: rgba(0, 0, 0, 0.1);
}
#chat-input {
  flex:1; background:rgba(0, 0, 0, 0.2); border:1px solid var(--border);
  border-radius:8px; padding:.65rem 1rem;
  color:var(--text); font-family:var(--mono); font-size:.85rem;
  outline:none; transition:.2s;
}
#chat-input:focus { border-color:rgba(0,229,255,.5); background:rgba(0,0,0,0.4); box-shadow: 0 0 10px rgba(0,229,255,0.1); }
#chat-input::placeholder { color:var(--muted); }

/* â”€â”€â”€ STATUS PANEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
#status-panel { grid-column:2; grid-row:2; }

.status-grid {
  display:grid; grid-template-columns:1fr 1fr;
  gap:.85rem; padding:1.2rem;
}
.stat-card {
  background:rgba(0, 0, 0, 0.2); border:1px solid var(--border);
  border-radius:10px; padding:1rem;
  transition: .2s ease;
}
.stat-card:hover { background: rgba(255,255,255,0.03); border-color: rgba(255,255,255,0.15); }
.stat-label { font-family:var(--mono); font-size:.65rem; color:var(--muted); letter-spacing:.1em; margin-bottom:.4rem; }
.stat-val   { font-size:1.2rem; font-weight:700; color:var(--text); }
.stat-val.accent { color:var(--accent); }

/* â”€â”€â”€ BUTTONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
button {
  cursor:pointer; border:none; border-radius:8px;
  font-family:var(--mono); font-size:.72rem; letter-spacing:.06em;
  transition:.2s; font-weight: bold;
}
.btn-primary {
  background:rgba(0,229,255,.15); border:1px solid rgba(0,229,255,.4);
  color:var(--accent); padding:.55rem 1.1rem;
  backdrop-filter: blur(4px);
}
.btn-primary:hover { background:rgba(0,229,255,.25); box-shadow: 0 0 15px rgba(0,229,255,0.2); }

.btn-danger {
  background:rgba(239,68,68,.15); border:1px solid rgba(239,68,68,.4);
  color:var(--danger); padding:.55rem 1.1rem;
}
.btn-danger:hover { background:rgba(239,68,68,.25); }

.btn-ghost {
  background:transparent; border:1px solid var(--border);
  color:var(--text); padding:.55rem 1.1rem;
}
.btn-ghost:hover { border-color:rgba(0,229,255,.3); color:var(--accent); background: rgba(255,255,255,0.02); }

.btn-icon {
  width:40px; height:40px; display:flex; align-items:center; justify-content:center;
  background:rgba(0,229,255,.1); border:1px solid rgba(0,229,255,.3);
  color:var(--accent); border-radius:8px; font-size:1.1rem;
  backdrop-filter: blur(4px);
}
.btn-icon:hover { background:rgba(0,229,255,.2); }
.btn-icon.recording { background:rgba(239,68,68,.2); border-color:rgba(239,68,68,.5); color:var(--danger); animation:recPulse 1s infinite; }
@keyframes recPulse { 0%,100%{opacity:1} 50%{opacity:.6} }

/* â”€â”€â”€ CLOCK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#clock { font-family:var(--mono); font-size:.85rem; color:var(--text); }

/* â”€â”€â”€ TOAST (Glass Effect) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#toast {
  position:fixed; bottom:1.5rem; right:1.5rem; z-index:1000;
  background:rgba(17, 24, 39, 0.85); border:1px solid var(--border);
  backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
  color:var(--text); font-family:var(--mono); font-size:.8rem;
  padding:.8rem 1.4rem; border-radius:10px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.3);
  opacity:0; transform:translateY(8px); transition:.3s;
  pointer-events:none;
}
#toast.show { opacity:1; transform:none; }

/* â”€â”€â”€ WAKE TOGGLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
.wake-btn {
  padding:.45rem 1rem; border-radius:20px; font-size:.7rem;
  background:rgba(255,255,255,.05); border:1px solid var(--border);
  color:var(--text); cursor:pointer; transition:.3s;
  font-family:var(--mono); letter-spacing:.06em;
}
.wake-btn:hover { background:rgba(255,255,255,.1); }
.wake-btn.active {
  background:rgba(34,197,94,.15); border-color:rgba(34,197,94,.4); color:var(--success);
  box-shadow: 0 0 14px rgba(34,197,94,.2);
}

/* â”€â”€â”€ SCROLLBAR GLOBAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
* { scrollbar-width:thin; scrollbar-color: rgba(255,255,255,0.1) transparent; }
</style>
</head>
<body>

<header>
  <div class="logo">
    <div class="logo-dot"></div>
    FRIDAY
  </div>

  <div class="header-right">
    <div id="clock">â€”</div>
    <div id="badge-groq"  class="badge off"><div class="badge-dot"></div> BRAIN</div>
    <div id="badge-cam"   class="badge off"><div class="badge-dot"></div> CAM</div>
    <div id="badge-kb"    class="badge off"><div class="badge-dot"></div> KB 0</div>
    <button id="wake-toggle" class="wake-btn" onclick="toggleWake()">âš¡ WAKE WORD</button>
    <a class="nav-link" href="/admin">âš™ Admin</a>
  </div>
</header>

<div class="grid">

  <div class="panel" id="camera-panel">
    <div class="panel-header">
      <div class="panel-title">ğŸ“· LIVE VISION</div>
      <span id="cam-status-label" style="font-size:.65rem;">OFFLINE</span>
    </div>

    <div class="panel-body">
      <div id="camera-feed">
        <img id="camera-img" alt="camera">
        <div id="camera-placeholder">
          <div class="cam-icon">ğŸ“·</div>
          <div>Camera is offline</div>
          <div style="font-size:.65rem;color:var(--muted)">Click START to activate</div>
        </div>
        <div id="detected-label">Detected: â€”</div>
      </div>
    </div>

    <div class="cam-controls">
      <button class="btn-primary" onclick="startCamera()">â–¶ START</button>
      <button class="btn-ghost"   onclick="stopCamera()">â–  STOP</button>
    </div>
  </div>

  <div class="panel" id="chat-panel">
    <div class="panel-header">
      <div class="panel-title">ğŸ’¬ FRIDAY CHAT</div>
      <button class="btn-ghost" onclick="clearHistory()" style="font-size:.62rem;padding:.25rem .7rem;">CLEAR</button>
    </div>

    <div id="chat-messages">
      <div class="msg assistant">
        Hello Boss! Friday online and ready. Ask me anything or upload a PDF to the knowledge base.
        <div class="msg-meta">System</div>
      </div>
      <div class="typing-indicator" id="typing">
        <span></span><span></span><span></span>
      </div>
    </div>

    <div class="chat-input-row">
      <input id="chat-input" placeholder="Ask Friday anythingâ€¦" onkeydown="if(event.key==='Enter')sendChat()">
      <button class="btn-icon" id="mic-btn" onclick="toggleMic()" title="Voice input">ğŸ¤</button>
      <button class="btn-primary" onclick="sendChat()">SEND</button>
    </div>
  </div>

  <div class="panel" id="status-panel">
    <div class="panel-header">
      <div class="panel-title">ğŸ“Š STATUS</div>
    </div>
    <div class="status-grid">
      <div class="stat-card">
        <div class="stat-label">DETECTED OBJECT</div>
        <div class="stat-val accent" id="s-detected">â€”</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">KNOWLEDGE BASE</div>
        <div class="stat-val" id="s-kb">0 docs</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">AI BRAIN</div>
        <div class="stat-val" id="s-brain">â€”</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">DATE</div>
        <div class="stat-val" id="s-date" style="font-size:.85rem;color:var(--muted)">â€”</div>
      </div>
    </div>
  </div>

</div><div id="toast"></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CLOCK
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updateClock() {
  const now = new Date();
  const t = now.toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit'});
  document.getElementById('clock').textContent = t;
}
updateClock(); setInterval(updateClock, 1000);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TOAST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toast(msg, ms=2500) {
  const el = document.getElementById('toast');
  el.textContent = msg; el.classList.add('show');
  setTimeout(() => el.classList.remove('show'), ms);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATUS POLL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function pollStatus() {
  try {
    const r = await fetch('/api/status');
    const s = await r.json();

    // Badges
    setBadge('badge-groq', s.groq_available, 'BRAIN');
    setBadge('badge-cam',  s.camera_active,  'CAM');
    document.getElementById('badge-kb').textContent = `KB ${s.kb_count}`;
    document.getElementById('badge-kb').className   = `badge ${s.kb_count>0?'on':'off'}`;

    // Status cards
    document.getElementById('s-detected').textContent = s.detected_object || 'â€”';
    document.getElementById('s-kb').textContent       = `${s.kb_count} doc${s.kb_count!==1?'s':''}`;
    document.getElementById('s-brain').textContent    = s.groq_available ? 'Groq âœ“' : 'Echo';
    document.getElementById('s-date').textContent     = s.date || 'â€”';
  } catch(e) {}
}

function setBadge(id, active, label) {
  const el = document.getElementById(id);
  el.className = `badge ${active ? 'on':'off'}`;
  el.innerHTML = `<div class="badge-dot"></div> ${label}`;
}

pollStatus(); setInterval(pollStatus, 3000);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// WAKE TOGGLE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let wakeActive = false;
async function toggleWake() {
  wakeActive = !wakeActive;
  await fetch('/api/wake', {method:'POST', headers:{'Content-Type':'application/json'},
    body: JSON.stringify({active: wakeActive})});
  const btn = document.getElementById('wake-toggle');
  btn.textContent = wakeActive ? 'âš¡ ACTIVE' : 'âš¡ WAKE WORD';
  btn.className   = wakeActive ? 'wake-btn active' : 'wake-btn';
  toast(wakeActive ? 'Wake word activated' : 'Wake word off');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CHAT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function sendChat() {
  const inp = document.getElementById('chat-input');
  const msg = inp.value.trim();
  if (!msg) return;
  inp.value = '';

  appendMsg('user', msg);
  showTyping(true);

  try {
    const r   = await fetch('/api/chat', {
      method:'POST', headers:{'Content-Type':'application/json'},
      body: JSON.stringify({message: msg})
    });
    const d   = await r.json();
    showTyping(false);
    appendMsg('assistant', d.response, d.used_kb);
  } catch(e) {
    showTyping(false);
    appendMsg('assistant', 'Connection error. Is the server running?');
  }
}

function appendMsg(role, text, usedKB=false) {
  const box = document.getElementById('chat-messages');
  const div = document.createElement('div');
  div.className = `msg ${role}`;

  const kb = usedKB ? '<span class="kb-tag">KB</span>' : '';
  const now = new Date().toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit'});
  div.innerHTML = `${text}${kb}<div class="msg-meta">${now}</div>`;

  const typing = document.getElementById('typing');
  box.insertBefore(div, typing);
  box.scrollTop = box.scrollHeight;
}

function showTyping(show) {
  document.getElementById('typing').style.display = show ? 'flex' : 'none';
}

async function clearHistory() {
  await fetch('/api/chat/history', {method:'DELETE'});
  const box = document.getElementById('chat-messages');
  // keep only first welcome msg + typing
  while (box.children.length > 2) box.removeChild(box.children[1]);
  toast('Chat cleared');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// VOICE INPUT (Web Speech API)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let recognizing = false;
let recog;

function toggleMic() {
  if (!('webkitSpeechRecognition' in window || 'SpeechRecognition' in window)) {
    toast('Speech API not supported in this browser'); return;
  }
  if (recognizing) { recog.stop(); return; }

  const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
  recog = new SR();
  recog.lang = 'en-US'; recog.continuous = false; recog.interimResults = false;

  recog.onstart = () => {
    recognizing = true;
    document.getElementById('mic-btn').classList.add('recording');
    document.getElementById('mic-btn').textContent = 'ğŸ”´';
    toast('Listeningâ€¦');
  };
  recog.onend = () => {
    recognizing = false;
    document.getElementById('mic-btn').classList.remove('recording');
    document.getElementById('mic-btn').textContent = 'ğŸ¤';
  };
  recog.onresult = (e) => {
    const t = e.results[0][0].transcript;
    document.getElementById('chat-input').value = t;
    sendChat();
  };
  recog.onerror = (e) => toast(`Mic error: ${e.error}`);
  recog.start();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CAMERA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let camInterval;

async function startCamera() {
  await fetch('/api/camera/start', {method:'POST'});
  document.getElementById('camera-placeholder').style.display = 'none';
  document.getElementById('camera-img').style.display = 'block';
  document.getElementById('cam-status-label').textContent = 'LIVE';
  document.getElementById('cam-status-label').style.color = 'var(--success)';
  toast('Camera started');
  camInterval = setInterval(fetchFrame, 120);
}

async function stopCamera() {
  clearInterval(camInterval);
  await fetch('/api/camera/stop', {method:'POST'});
  document.getElementById('camera-placeholder').style.display = 'flex';
  document.getElementById('camera-img').style.display = 'none';
  document.getElementById('cam-status-label').textContent = 'OFFLINE';
  document.getElementById('cam-status-label').style.color = '';
  toast('Camera stopped');
}

async function fetchFrame() {
  try {
    const r = await fetch('/api/camera/frame');
    const d = await r.json();
    document.getElementById('camera-img').src = `data:image/jpeg;base64,${d.frame}`;
    document.getElementById('detected-label').textContent = `Detected: ${d.detected || 'â€”'}`;
    document.getElementById('s-detected').textContent = d.detected || 'â€”';
  } catch(e) {}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// APPLY THEME (from admin)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadTheme() {
  try {
    const r = await fetch('/api/theme');
    const t = await r.json();
    const root = document.documentElement;
    if (t.accent)  root.style.setProperty('--accent',  t.accent);
    if (t.bg)      root.style.setProperty('--bg',      t.bg);
    if (t.surface) root.style.setProperty('--surface', t.surface);
    if (t.text)    root.style.setProperty('--text',    t.text);
  } catch(e) {}
}
loadTheme();
</script>
</body>
</html>